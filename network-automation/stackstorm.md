# Stackstorm

* Platform for integration and automation across services and tools
* Ties together existing infrastructure and application environment
* Focuses on taking actions in response to events

* Facilitated troubleshooting
* Automated remediation
* Continuous deployment

Compose these rules and workflows as code.

## How it Works

1. Events are aggregated (Push/Pull) from various services via sensors
2. Events are compared against triggers and generate actions
3. Processed actions areplaced on a message queue (rabbit mq)
4. Actions reach out to services to perform the actions
5. Log/audit history is pushed to the db (mongo)
6. Processed results are sent back to the rules engine for further processing

Terms:
* Sensors - python plugins. Inbound or outbound, receive or watch for events. A trigger is generated by sdtackstorm.
* Triggers - stackstorm representations of external events
* Actions - Outbound integrations. Eg. SSH, rest call, openstack, docker, ansible, 
* Rules - Map triggers to actions or workflows.
* Workflows - Stitch actions together, define order, transitions and passing data.
* Packs - units of content deployment (plugins) found on [stackstorm exchange](https://exchange.stackstorm.org/)
* Audit trail - actions are recorded and stored. 

## Reference Deployment

### ST2 Services

* Provides the main stackstorm functionality
* Located at `/opt/stackstorm/st2`
* Share a virtualenv
* Configured via `/etc/st2/st2.conf`

[Read more about the reference deployment on stackstorm](https://docs.stackstorm.com/install/overview.html)

## Getting Started

Check the st2 version:

    st2 --version
    st2 3.0.0, on Python 2.7.12

Login:

    st2 login st2admin -p Ch@ngeMe

List actions from the core pack:

    st2 action list --pack=core
    
List all the triggers:

    st2 trigger list

List rules:

    st2 rule list

Run a local shell command:

    st2 run core.local -- date -R

See the execution results:

    st2 execution list

Run a command on a remote host:

    st2 run core.remote hosts='localhost' -- uname -a

> All stackstorm operations are also available via the REST Api

List all actions:

    st2 action list

Get action metadata:

    st2 action get core.http

Get details and paramters for an action:

    st2 run core.http --help

To run an action from the cli use:

    st2 run <action> key=value positional arguments

Eg. `st2 run -j core.http url="https://docs.stackstorm.com" method="GET"`

Use `core.remote` to run linux commands on multiple hosts via ssh. It assumes passwordless ssh is configured for the host.

For `core.local` and `core.remote` use `--` to seperate the command run on the host or use the `cmd` parameter.

    st2 run core.local -- ls -al
    st2 run core.local cmd="ls -al"

Get a list of executions:

    st2 execution list

Get a single execution:

    st2 execution get 5cc6f3766cb8de088e9dab3c

Get the last 5 executions:

    st2 execution list -n 5



